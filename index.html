<!-- zona dentro de body donde mostramos sets / cards -->
<div id="sets-container"></div>
<div id="cards-container"></div>

<!-- scripts: usa type=module -->
<script type="module">
  import { initLazyLoad } from './js/lazyload.js';
  import { getExpansions, getCardsByExpansion } from './js/api.js';

  document.addEventListener('DOMContentLoaded', async () => {
    initLazyLoad('200px');

    // listar expansiones
    try {
      const setsResp = await getExpansions();
      // adapta este código al shape real de tu API
      const sets = setsResp.data || setsResp; // ejemplo: { data: [...] } o [...]
      const setsContainer = document.getElementById('sets-container');
      setsContainer.innerHTML = sets.map(s=>{
        return `<button class="set-btn" data-set-id="${s.id}">${s.name}</button>`;
      }).join('');
      setsContainer.addEventListener('click', async (e) => {
        const btn = e.target.closest('.set-btn');
        if (!btn) return;
        const setId = btn.dataset.setId;
        // limpia contenedor de cards
        const cardsContainer = document.getElementById('cards-container');
        cardsContainer.innerHTML = 'Cargando...';
        const cardsResp = await getCardsByExpansion(setId, 1, 24);
        const cards = cardsResp.data || cardsResp.cards || [];
        cardsContainer.innerHTML = cards.map(c => `
          <article class="card-item">
            <picture>
              <source type="image/webp" data-srcset="${(c.images?.small ?? '')} 200w">
              <img data-src="${c.images?.small ?? ''}" loading="lazy" width="200" height="280" alt="${c.name}">
            </picture>
            <h4>${c.name}</h4>
          </article>
        `).join('');
        initLazyLoad('200px'); // re-inicializa lazyload para las nuevas imágenes
      });
    } catch (err) {
      console.error('Error cargando sets:', err);
    }

    // registra SW
    if ('serviceWorker' in navigator) {
      try {
        await navigator.serviceWorker.register('/sw.js');
        console.log('SW registered');
      } catch (err) {
        console.warn('SW fail', err);
      }
    }
  });
</script>
